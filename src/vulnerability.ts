/* --------------------------------------------------------------------------------------------
 * Copyright (c) Red Hat
 * Licensed under the Apache-2.0 License. See License.txt in the project root for license information.
 * ------------------------------------------------------------------------------------------ */
'use strict';
import { Diagnostic, DiagnosticSeverity } from 'vscode-languageserver';
import { Range } from 'vscode-languageserver';
import { VERSION_TEMPLATE } from './utils';
import { IDependencyProvider } from './collector';

const AnalyticsSource = '\nRed Hat Dependency Analytics Plugin [Powered by Snyk]';

/* Vulnerability data along with package name and version */
class Vulnerability {
    provider: IDependencyProvider;
    range: Range;
    issuesCount: number;
    ref: string;
    // recommendation: any;
    // recommendationName: string;
    // recommendationVersion: string;
    // remediations: any;
    highestVulnerabilitySeverity: string;
    replacement: string;

    constructor(
        range: Range,
        ref: string,
        issuesCount: number = 0,
        // recommendation: any = null,
        // recommendationName: string = null,
        // recommendationVersion: string = null,
        // remediations: any = null,
        highestVulnerabilitySeverity: string = null,
        replacement: string = null,
        ) {
        this.range = range;
        this.ref = ref;
        this.issuesCount = issuesCount || 0;
        // this.recommendation = recommendation || null;
        // this.recommendationName = recommendationName || '';
        // this.recommendationVersion = recommendationVersion || '';
        // this.remediations = remediations || null;
        this.highestVulnerabilitySeverity = highestVulnerabilitySeverity || '';
        this.replacement = replacement || VERSION_TEMPLATE;
    }

    getDiagnostic(): Diagnostic {

        if (this.issuesCount === 0) {
            return;
//             diagSeverity = DiagnosticSeverity.Information;

//             if (this.recommendation !== null) {
//                 msg = `${this.ref}
// Recommendation: ${this.recommendationName}:${this.recommendationVersion}`;
//             } else {
//                 msg = `${this.ref}
// Recommendation: No RedHat packages to recommend`;
//             }
        }

        let diagSeverity = DiagnosticSeverity.Error;
        let msg = `${this.ref.replace(`pkg:${this.provider.ecosystem}/`, '')}
Known security vulnerabilities: ${this.issuesCount}
Highest severity: ${this.highestVulnerabilitySeverity}`;
//             msg = `${this.ref}
// Known security vulnerabilities: ${this.issuesCount}
// Highest severity: ${this.highestVulnerabilitySeverity}
// Has remediation: ${this.remediations && Object.keys(this.remediations).length > 0 ? 'Yes' : 'No'}`;

        return {
            severity: diagSeverity,
            range: this.range,
            message: msg,
            source: AnalyticsSource,
        };
    }
}

export { Vulnerability, AnalyticsSource };